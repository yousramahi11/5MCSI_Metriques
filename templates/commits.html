<html>
  <head>
    <meta charset="UTF-8" />
    <title>Graphique des commits (par minute)</title>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
  </head>
  <body>
    <h2>Graphique des commits (par minute)</h2>
    <div id="commits_chart"></div>

    <script>
      // Chargement de Google Charts
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(loadData);

      // Récupère les données de l'API Flask /commits-data/
      function loadData() {
        fetch("/commits-data/")
          .then((response) => response.json())
          .then((data) => {
            drawChart(data.results);
          });
      }

      // Dessine le graphique en colonnes
      function drawChart(results) {
        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn("string", "Minute");
        dataTable.addColumn("number", "Commits");

        results.forEach(function (entry) {
          dataTable.addRow([entry.minute, entry.count]);
        });

        var options = {
          title: "Commits par minute",
          legend: { position: "none" },
          hAxis: { title: "Minute" },
          vAxis: { title: "Nombre de commits" },
        };

        var chart = new google.visualization.ColumnChart(
          document.getElementById("commits_chart")
        );
        chart.draw(dataTable, options);
      }
    </script>
  </body>
</html>
